+++
date = "2023-01-15"
title = "A new search engine for your Hugo website based on Lyra"
slug = "hugo-search-engine-lyra"
tags = ["hugo", "lyra"]
draft = "false"
featuredImage = "images/posts/4-hugo-lyra/dall-e-hugo-lyra-image.webp"
images = ["images/posts/4-hugo-lyra/dall-e-hugo-lyra-image.webp"]
+++

As per tradition, the image of this post is generated by **DALL-E**, and it well represents the content of the article: an investigator (aka [Hugo](https://www.gohugo.io)) with his magic lens ([LyraSearch](https://github.com/LyraSearch/lyra)) searching for interesting content in a galaxy, _far, far away_.

What I love more about the Christmas holidays **üéÖ**, apart from the tremendous amount of food, is the spare time I have to draw a line from the year that just passed and, finally, go through the most exciting stuff I encountered along the way, one of them is [LyraSearch](https://github.com/LyraSearch/lyra), a javascript search engine, which is a: _‚Äúüåå Fast, in-memory, typo-tolerant, full-text search engine written in TypeScript.‚Äù_

I knew the project better when we invited [Michele Riva](https://www.micheleriva.it/), the inventor of this project, to our [company Podcast](https://www.youtube.com/@ContinuousDeliverySpark), it was a great episode with many interesting discussions, sadly it is just in Italian but with the help of the AI and the automatic translations you can try to follow it anyway, In any case, you‚Äôll find many contents and talks in English from Michele and for sure you can see him speaking to the next conference around you.

{{< youtube p7-foWEKPVA >}}

## What is Lyra?

Taken from the [website](https://docs.lyrasearch.io/):

‚Äú_Lyra is an¬†**immutable, runtime-agnostic, edge, and in-memory full-text search engine**¬†that works both on client and server._

_Through implementing an optimized prefix tree and some clever tweaks, Lyra can perform searches through millions of entries in¬†**microseconds**.‚Äù_

And it only requires a **Javascript runtime** to work; this means that any browser can be **super-powered** as a **complete full-text search engine;** if you combine it with the incredible market rising of frontend frameworks and static generated sites, you can imagine how this kind of project is needed now.

Which **static site** today doesn‚Äôt need a **simple** and integrated **search engine**? And what, if you can have it **without paying** for **server-side computing power**? This is precisely the space of projects like Lyra; you can self-host your site along your search engine in the same space, hopefully for free.

**I liked Lyra'**s **attention from the ground** up to the **performance** and t[he algorithms](https://github.com/LyraSearch/lyra/tree/main/src/radix-tree)' design, which is Michele‚Äôs passion, as he told us in the podcast.

Lyra is an **open-source and** **modern Typescript project**, easy to extend thanks to its **plugin architecture;** you can already find several plugins on the [Lyrasearch organization](https://github.com/LyraSearch).

It is still in its infancy, so it is easy to contribute, extend, and adapt it, and why not, dig into the code to learn how to build a search engine.

At the moment is still quite limited in features (no facets, no data shards, no search DSL‚Ä¶), and the data structures are not yet stable, but for the most simple use cases, it works out of the box, and considering the traction that is having I bet a bright future for the project, maybe one-day feature compelling with big commercial products like Algolia or Doofinder.

A project worth mentioning very similar to Lyra is [Lunr](https://github.com/olivernn/lunr.js/) (_‚ÄùA bit like Solr, but much smaller and not as bright‚Äù from the GitHub project description)_, it is open-source and Javascript based, and it shares with Lyra most of the search limitations I mentioned before, and it seems to be not very active nowadays; the [last commit](https://github.com/olivernn/lunr.js/commit/aa5a878f62a6bba1e8e5b95714899e17e8150b38) is dated Aug 19, 2020, that can also mean that the project reached the desired feature state and it will not advance more, or that is just more or less abandoned to its destiny. Anyway, this project works well too, and it is battle-tested in thousands of installations and easy to adopt and use in production. (Ed: We use it on our [company website](https://www.sparkfabrik.com/en/)).

## What is Hugo?

‚Äú[Hugo](https://gohugo.io/) is one of the most popular open-source static site generators. With its amazing speed and flexibility, Hugo makes building websites fun again.‚Äù

And it is also the engine [of this blog](https://github.com/paolomainardi/paolomainardi.com) and [many, many others](https://www.wappalyzer.com/technologies/static-site-generator/hugo/).

As the name suggests, it is written in Go, so to use it, only a single binary is needed, which is responsible for serving the development environment and building up from the sources to the static files.

What I like more about Hugo:

- No dependencies, just a static binary (multi-arch)
- Very fast (serve, build) and intuitive
- Native support for CMS-like concepts like content types, taxonomies, menus, etc.
- [Hugo Pipes](https://gohugo.io/hugo-pipes/introduction/) - a very powerful way to process assets (including Javascript transpiling)
- Many [free themes](https://themes.gohugo.io/) to use (if you, like me, are CSS-üêê) - I use [Hugo Coder](https://github.com/luizdepra/hugo-coder); big kudos to the team.

Well, as it can be easy to imagine, a static site is just a bunch of HTML, CSS, and Javascript files, and Hugo comes without a native client-side search engine solution; the [documentation point to external resources](https://gohugo.io/tools/search/) to implement by yourself what you need, most of them are based on Lunr.

**And we have finally arrived straight at the point** **[üéâ](https://emojipedia.org/party-popper/)**

## Hugo + Lyra

Let‚Äôs start by sharing the **project‚Äôs repository**: [https://github.com/paolomainardi/hugo-lyra](https://github.com/paolomainardi/hugo-lyra)

You can also [test it](https://www.paolomainardi.com/posts/) on this blog; not really needed because, at the time of writing this post, there are just 4 contents (including this one), but I thought that was better than creating a fictional demo site, the [blog source code is also hosted on Github](https://github.com/paolomainardi/paolomainardi.com), so you can also see it how is integrated.

It is implemented in **Typescript**, licensed under the Apache-2.0 license, and I tried to reuse many of the practices used on the original project (QA tools, test runner, coding style, etc.)

It comes with **server-side Node implementation**, also exposed as a CLI and a **client-side library**, which exposes some helpers to getting started quickly.

**This time I invested** more than a few seconds to [write a decent README](https://github.com/paolomainardi/hugo-lyra/blob/main/README.md), so instead of writing how it works again here, you can rely on it; it will hopefully be helpful.

Instead, I want to share **what I learned** building this project:

1. My feelings on **Typescript** are _not yet clear_; I like the idea a lot but am scared of the pile of layers on top of the bare language; sometimes, debugging types or finding them (if any) is frustrating; maybe it‚Äôs also a matter of being used on it, as my daily work does not involve anymore writing a lot of code in TS.
2. **[Esbuild](https://esbuild.github.io/) is just awesome**, I never had the chance to try it in a real-world project before, and I guess we are finally over the Webpack configuration monstrosity; much respect for it, but DX is all on the Esbuild's side.
3. [Node-tap](https://node-tap.org/) is the test library to use with Node; **easy**, **straightforward**, with **no frills**, and the **maintainers** are **awesome and responsive**. Another project I didn‚Äôt know before starting building.
4. **ESM - CJS is still a big giant mess**, and the pain of trying to build isomorphic code, while wrestling between CJS, AMD, UMD, ESM, System, and IIFE formats and the combination of stuff to put on package.json. {{< tweet user="MicheleRivaCode" id="1613904206229897223" >}}
5. [Release-it](https://github.com/release-it/release-it) is a lovely project to release NPM projects and taking in charge of all the tedious tasks involved in the release process, like tagging, Changelog file updates, release on NPM, and release on Github; [here](https://github.com/paolomainardi/hugo-lyra/blob/main/.github/workflows/release.yml) is the GitHub workflow.

## Conclusions

**I had a lot of fun building it!**

I finally had the chance to **refresh my knowledge of a rapidly evolving Javascript ecosystem**, not only by reading articles or quickly testing things but building from scratch a new one.

Nothing **is more rewarding** than **envisioning building and releasing a product** with your hands**,** even the smaller one, contributing to the open-source ecosystem and being part of a community.

**My advice** is to **find a topic** or a **project you like**, you want to **improve yourself**, or have always **wanted to learn** and **start building**; we live in such a **wonderful era for developers**; we can build unimaginable things and transform thoughts into living things potentially used by thousands, millions, or people in a matter of seconds.

[There are still tons of things to do here](https://github.com/paolomainardi/hugo-lyra/issues), like multilingual and dynamic indexes; come to say hi, any contribution, even the typo, will be welcome.
